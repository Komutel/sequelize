{
  "version": 3,
  "sources": ["../../src/utils/string.ts"],
  "sourcesContent": ["import NodeUtil from 'node:util';\r\nimport _inflection from 'inflection';\r\nimport type { IndexOptions, TableName } from '../dialects/abstract/query-interface.js';\r\nimport { SequelizeMethod } from './sequelize-method.js';\r\n\r\n/* Inflection */\r\ntype Inflection = typeof _inflection;\r\n\r\nlet inflection: Inflection = _inflection;\r\n\r\nexport function useInflection(newInflection: Inflection) {\r\n  inflection = newInflection;\r\n}\r\n\r\n/* String utils */\r\n\r\nexport function camelizeIf(str: string, condition: boolean): string {\r\n  let result = str;\r\n\r\n  if (condition) {\r\n    result = camelize(str);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function camelize(str: string): string {\r\n  return str.trim().replace(/[-_\\s]+(.)?/g, (match, c) => c.toUpperCase());\r\n}\r\n\r\nexport function underscoredIf(str: string, condition: boolean): string {\r\n  let result = str;\r\n\r\n  if (condition) {\r\n    result = underscore(str);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function underscore(str: string): string {\r\n  return inflection.underscore(str);\r\n}\r\n\r\nexport function spliceStr(\r\n  str: string,\r\n  index: number,\r\n  count: number,\r\n  add: string,\r\n): string {\r\n  return str.slice(0, index) + add + str.slice(index + count);\r\n}\r\n\r\nexport function singularize(str: string): string {\r\n  return inflection.singularize(str);\r\n}\r\n\r\nexport function pluralize(str: string): string {\r\n  return inflection.pluralize(str);\r\n}\r\n\r\ntype NameIndexIndex = {\r\n  fields: Array<{ name: string, attribute: string }>,\r\n  name: string,\r\n};\r\n\r\n/**\r\n *\r\n * @param index\r\n * @param index.fields\r\n * @param index.name\r\n * @param tableName\r\n *\r\n * @private\r\n */\r\nexport function nameIndex(\r\n  index: NameIndexIndex,\r\n  tableName: TableName,\r\n) {\r\n  if (Object.prototype.hasOwnProperty.call(index, 'name')) {\r\n    return index;\r\n  }\r\n\r\n  index.name = generateIndexName(tableName, index);\r\n\r\n  return index;\r\n}\r\n\r\nexport function generateIndexName(tableName: TableName, index: IndexOptions): string {\r\n  if (typeof tableName !== 'string' && tableName.tableName) {\r\n    tableName = tableName.tableName;\r\n  }\r\n\r\n  if (!index.fields) {\r\n    throw new Error(`Index on table ${tableName} has not fields:\r\n${NodeUtil.inspect(index)}`);\r\n  }\r\n\r\n  const fields = index.fields.map(field => {\r\n    if (typeof field === 'string') {\r\n      return field;\r\n    }\r\n\r\n    if (field instanceof SequelizeMethod) {\r\n      // eslint-disable-next-line unicorn/prefer-type-error -- not a type error.\r\n      throw new Error(`Index on table ${tableName} uses Sequelize's ${field.constructor.name} as one of its fields. You need to name this index manually.`);\r\n    }\r\n\r\n    if ('attribute' in field) {\r\n      throw new Error('Property \"attribute\" in IndexField has been renamed to \"name\"');\r\n    }\r\n\r\n    return field.name;\r\n  });\r\n\r\n  let out = `${tableName}_${fields.join('_')}`;\r\n\r\n  if (index.unique) {\r\n    out += '_unique';\r\n  }\r\n\r\n  return underscore(out);\r\n}\r\n\r\n/**\r\n * Stringify a value as JSON with some differences:\r\n * - bigints are stringified as a json string. (`safeStringifyJson({ val: 1n })` outputs `'{ \"val\": \"1\" }'`).\r\n *   This is because of a decision by TC39 to not support bigint in JSON.stringify https://github.com/tc39/proposal-bigint/issues/24\r\n *\r\n * @param stringifyTarget the value to stringify.\r\n * @returns the resulting json.\r\n */\r\nexport function safeStringifyJson(stringifyTarget: any): string {\r\n  return JSON.stringify(stringifyTarget, (key, value) => {\r\n    if (typeof value === 'bigint') {\r\n      return String(value);\r\n    }\r\n\r\n    return value;\r\n  });\r\n}\r\n\r\nexport function removeTrailingSemicolon(str: string): string {\r\n  if (!str.endsWith(';')) {\r\n    return str;\r\n  }\r\n\r\n  return str.slice(0, Math.max(0, str.length - 1));\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAqB;AACrB,wBAAwB;AAExB,8BAAgC;AAKhC,IAAI,aAAyB,kBAAAA;AAEtB,SAAS,cAAc,eAA2B;AACvD,eAAa;AACf;AAIO,SAAS,WAAW,KAAa,WAA4B;AAClE,MAAI,SAAS;AAEb,MAAI,WAAW;AACb,aAAS,SAAS,GAAG;AAAA,EACvB;AAEA,SAAO;AACT;AAEO,SAAS,SAAS,KAAqB;AAC5C,SAAO,IAAI,KAAK,EAAE,QAAQ,gBAAgB,CAAC,OAAO,MAAM,EAAE,YAAY,CAAC;AACzE;AAEO,SAAS,cAAc,KAAa,WAA4B;AACrE,MAAI,SAAS;AAEb,MAAI,WAAW;AACb,aAAS,WAAW,GAAG;AAAA,EACzB;AAEA,SAAO;AACT;AAEO,SAAS,WAAW,KAAqB;AAC9C,SAAO,WAAW,WAAW,GAAG;AAClC;AAEO,SAAS,UACd,KACA,OACA,OACA,KACQ;AACR,SAAO,IAAI,MAAM,GAAG,KAAK,IAAI,MAAM,IAAI,MAAM,QAAQ,KAAK;AAC5D;AAEO,SAAS,YAAY,KAAqB;AAC/C,SAAO,WAAW,YAAY,GAAG;AACnC;AAEO,SAAS,UAAU,KAAqB;AAC7C,SAAO,WAAW,UAAU,GAAG;AACjC;AAgBO,SAAS,UACd,OACA,WACA;AACA,MAAI,OAAO,UAAU,eAAe,KAAK,OAAO,MAAM,GAAG;AACvD,WAAO;AAAA,EACT;AAEA,QAAM,OAAO,kBAAkB,WAAW,KAAK;AAE/C,SAAO;AACT;AAEO,SAAS,kBAAkB,WAAsB,OAA6B;AACnF,MAAI,OAAO,cAAc,YAAY,UAAU,WAAW;AACxD,gBAAY,UAAU;AAAA,EACxB;AAEA,MAAI,CAAC,MAAM,QAAQ;AACjB,UAAM,IAAI,MAAM,kBAAkB;AAAA,EACpC,iBAAAC,QAAS,QAAQ,KAAK,GAAG;AAAA,EACzB;AAEA,QAAM,SAAS,MAAM,OAAO,IAAI,WAAS;AACvC,QAAI,OAAO,UAAU,UAAU;AAC7B,aAAO;AAAA,IACT;AAEA,QAAI,iBAAiB,yCAAiB;AAEpC,YAAM,IAAI,MAAM,kBAAkB,8BAA8B,MAAM,YAAY,kEAAkE;AAAA,IACtJ;AAEA,QAAI,eAAe,OAAO;AACxB,YAAM,IAAI,MAAM,+DAA+D;AAAA,IACjF;AAEA,WAAO,MAAM;AAAA,EACf,CAAC;AAED,MAAI,MAAM,GAAG,aAAa,OAAO,KAAK,GAAG;AAEzC,MAAI,MAAM,QAAQ;AAChB,WAAO;AAAA,EACT;AAEA,SAAO,WAAW,GAAG;AACvB;AAUO,SAAS,kBAAkB,iBAA8B;AAC9D,SAAO,KAAK,UAAU,iBAAiB,CAAC,KAAK,UAAU;AACrD,QAAI,OAAO,UAAU,UAAU;AAC7B,aAAO,OAAO,KAAK;AAAA,IACrB;AAEA,WAAO;AAAA,EACT,CAAC;AACH;AAEO,SAAS,wBAAwB,KAAqB;AAC3D,MAAI,CAAC,IAAI,SAAS,GAAG,GAAG;AACtB,WAAO;AAAA,EACT;AAEA,SAAO,IAAI,MAAM,GAAG,KAAK,IAAI,GAAG,IAAI,SAAS,CAAC,CAAC;AACjD;",
  "names": ["_inflection", "NodeUtil"]
}
